package javaapplication4;

import javax.swing.*;
import java.awt.*;
import java.awt.event.*;
import java.util.ArrayList;

class Student {
    String name;
    String section;
    int present, late, absent;
    double totalScore;
    int totalExams;

    Student(String name, String section) {
        this.name = name;
        this.section = section;
        this.present = this.late = this.absent = 0;
        this.totalScore = 0;
        this.totalExams = 0;
    }

    double getAttendanceRate() {
        int total = present + late + absent;
        if (total == 0) return 0;
        return (present * 100.0) / total;
    }

    double getAverageGrade() {
        if (totalExams == 0) return 0;
        return totalScore / totalExams;
    }

    String getSummary() {
        return "Name: " + name + " | Section: " + section +
                " | Present: " +  present + " | Late: " + late + " | Absent: " + absent +
                " | Attendance Rate: " + String.format("%.2f", getAttendanceRate()) + "%" +
                " | Average Grade: " + String.format("%.2f", getAverageGrade()) + "";
    }
}

public class StudentSystemGUI extends JFrame {

    static ArrayList<Student> students = new ArrayList<>();

    CardLayout cardLayout = new CardLayout();
    JPanel mainPanel = new JPanel(cardLayout);

    public StudentSystemGUI() {
        setTitle("Student Attendance and Grade System");
        setSize(500, 400);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLocationRelativeTo(null);

        initLoginPanel();
        initMenuPanel();
        initAddStudentPanel();
        initAttendancePanel();
        initScorePanel();
        initViewPanel();

        add(mainPanel);
        cardLayout.show(mainPanel, "login");
        setVisible(true);
    }

    // ===== LOGIN PANEL =====
    void initLoginPanel() {
        JPanel loginPanel = new JPanel(new GridBagLayout());
        GridBagConstraints gbc = new GridBagConstraints();
        gbc.insets = new Insets(10,10,10,10);

        JLabel userLabel = new JLabel("Username:");
        JLabel passLabel = new JLabel("Password:");
        JTextField userField = new JTextField(15);
        JPasswordField passField = new JPasswordField(15);
        JButton loginButton = new JButton("Login");

        gbc.gridx = 0; gbc.gridy = 0;
        loginPanel.add(userLabel, gbc);
        gbc.gridx = 1;
        loginPanel.add(userField, gbc);

        gbc.gridx = 0; gbc.gridy = 1;
        loginPanel.add(passLabel, gbc);
        gbc.gridx = 1;
        loginPanel.add(passField, gbc);

        gbc.gridx = 0; gbc.gridy = 2; gbc.gridwidth = 2;
        loginPanel.add(loginButton, gbc);

        loginButton.addActionListener(e -> {
            String user = userField.getText().trim();
            String pass = new String(passField.getPassword()).trim();
            // Hardcoded login for simplicity
            if(user.equals("admin") && pass.equals("1234")) {
                JOptionPane.showMessageDialog(this, "Login successful!");
                cardLayout.show(mainPanel, "menu");
            } else {
                JOptionPane.showMessageDialog(this, "Invalid username or password");
            }
        });

        mainPanel.add(loginPanel, "login");
    }

    // ===== MAIN MENU PANEL =====
    void initMenuPanel() {
        JPanel menuPanel = new JPanel(new GridLayout(5,1,10,10));
        JButton addBtn = new JButton("Add Student");
        JButton attendBtn = new JButton("Record Attendance");
        JButton scoreBtn = new JButton("Add Quiz/Exam Score");
        JButton viewBtn = new JButton("View Student Summary");
        JButton exitBtn = new JButton("Exit");

        addBtn.addActionListener(e -> cardLayout.show(mainPanel, "addStudent"));
        attendBtn.addActionListener(e -> cardLayout.show(mainPanel, "attendance"));
        scoreBtn.addActionListener(e -> cardLayout.show(mainPanel, "score"));
        viewBtn.addActionListener(e -> cardLayout.show(mainPanel, "view"));
        exitBtn.addActionListener(e -> System.exit(0));

        menuPanel.add(addBtn);
        menuPanel.add(attendBtn);
        menuPanel.add(scoreBtn);
        menuPanel.add(viewBtn);
        menuPanel.add(exitBtn);

        mainPanel.add(menuPanel, "menu");
    }

    // ===== ADD STUDENT PANEL =====
    void initAddStudentPanel() {
        JPanel panel = new JPanel(new GridBagLayout());
        GridBagConstraints gbc = new GridBagConstraints();
        gbc.insets = new Insets(5,5,5,5);

        JLabel nameLabel = new JLabel("Name:");
        JLabel secLabel = new JLabel("Section:");
        JTextField nameField = new JTextField(15);
        JTextField secField = new JTextField(5);
        JButton addButton = new JButton("Add");
        JButton backButton = new JButton("Back");

        gbc.gridx = 0; gbc.gridy = 0; panel.add(nameLabel, gbc);
        gbc.gridx = 1; panel.add(nameField, gbc);
        gbc.gridx = 0; gbc.gridy = 1; panel.add(secLabel, gbc);
        gbc.gridx = 1; panel.add(secField, gbc);
        gbc.gridx = 0; gbc.gridy = 2; gbc.gridwidth = 2;
        panel.add(addButton, gbc);
        gbc.gridy = 3; panel.add(backButton, gbc);

        addButton.addActionListener(e -> {
            String name = nameField.getText().trim();
            String section = secField.getText().trim();
            if(!name.matches("[a-zA-Z ]+")) {
                JOptionPane.showMessageDialog(this, "Invalid name! Letters only.");
                return;
            }
            if(!section.matches("[0-9]+")) {
                JOptionPane.showMessageDialog(this, "Invalid section! Numbers only.");
                return;
            }
            for(Student s : students) {
                if(s.name.equalsIgnoreCase(name)) {
                    JOptionPane.showMessageDialog(this, "Student already exists!");
                    return;
                }
            }
            students.add(new Student(name, section));
            JOptionPane.showMessageDialog(this, "Student added successfully!");
            nameField.setText(""); secField.setText("");
        });

        backButton.addActionListener(e -> cardLayout.show(mainPanel, "menu"));
        mainPanel.add(panel, "addStudent");
    }

    // ===== ATTENDANCE PANEL =====
    void initAttendancePanel() {
        JPanel panel = new JPanel(new GridBagLayout());
        GridBagConstraints gbc = new GridBagConstraints();
        gbc.insets = new Insets(5,5,5,5);

        JLabel nameLabel = new JLabel("Student Name:");
        JTextField nameField = new JTextField(15);
        JButton presentBtn = new JButton("Present");
        JButton lateBtn = new JButton("Late");
        JButton absentBtn = new JButton("Absent");
        JButton backButton = new JButton("Back");

        gbc.gridx = 0; gbc.gridy = 0; panel.add(nameLabel, gbc);
        gbc.gridx = 1; panel.add(nameField, gbc);
        gbc.gridy = 1; panel.add(presentBtn, gbc);
        gbc.gridx = 2; panel.add(lateBtn, gbc);
        gbc.gridx = 3; panel.add(absentBtn, gbc);
        gbc.gridx = 1; gbc.gridy = 2; panel.add(backButton, gbc);

        ActionListener recordListener = e -> {
            String name = nameField.getText().trim();
            if(!name.matches("[a-zA-Z ]+")) {
                JOptionPane.showMessageDialog(this, "Invalid name!");
                return;
            }
            Student s = null;
            for(Student st : students) if(st.name.equalsIgnoreCase(name)) s = st;
            if(s == null) { JOptionPane.showMessageDialog(this, "Student not found!"); return; }

            if(e.getSource() == presentBtn) s.present++;
            else if(e.getSource() == lateBtn) s.late++;
            else s.absent++;

            JOptionPane.showMessageDialog(this, "Attendance recorded!");
            nameField.setText("");
        };

        presentBtn.addActionListener(recordListener);
        lateBtn.addActionListener(recordListener);
        absentBtn.addActionListener(recordListener);
        backButton.addActionListener(e -> cardLayout.show(mainPanel, "menu"));

        mainPanel.add(panel, "attendance");
    }

    // ===== SCORE PANEL =====
    void initScorePanel() {
        JPanel panel = new JPanel(new GridBagLayout());
        GridBagConstraints gbc = new GridBagConstraints();
        gbc.insets = new Insets(5,5,5,5);

        JLabel nameLabel = new JLabel("Student Name:");
        JLabel scoreLabel = new JLabel("Score:");
        JTextField nameField = new JTextField(15);
        JTextField scoreField = new JTextField(5);
        JButton addBtn = new JButton("Add Score");
        JButton backBtn = new JButton("Back");

        gbc.gridx = 0; gbc.gridy = 0; panel.add(nameLabel, gbc);
        gbc.gridx = 1; panel.add(nameField, gbc);
        gbc.gridx = 0; gbc.gridy = 1; panel.add(scoreLabel, gbc);
        gbc.gridx = 1; panel.add(scoreField, gbc);
        gbc.gridx = 0; gbc.gridy = 2; gbc.gridwidth = 2;
        panel.add(addBtn, gbc);
        gbc.gridy = 3; panel.add(backBtn, gbc);

        addBtn.addActionListener(e -> {
            String name = nameField.getText().trim();
            String scoreText = scoreField.getText().trim();
            if(!name.matches("[a-zA-Z ]+")) { JOptionPane.showMessageDialog(this, "Invalid name!"); return; }
            Student s = null;
            for(Student st : students) if(st.name.equalsIgnoreCase(name)) s = st;
            if(s == null) { JOptionPane.showMessageDialog(this, "Student not found!"); return; }

            double score;
            try { score = Double.parseDouble(scoreText); }
            catch(Exception ex) { JOptionPane.showMessageDialog(this, "Invalid score!"); return; }

            if(score < 0 || score > 100) { JOptionPane.showMessageDialog(this, "Score must be 0-100!"); return; }
            s.totalScore += score;
            s.totalExams++;
            JOptionPane.showMessageDialog(this, "Score recorded!");
            nameField.setText(""); scoreField.setText("");
        });

        backBtn.addActionListener(e -> cardLayout.show(mainPanel, "menu"));
        mainPanel.add(panel, "score");
    }

    // ===== VIEW STUDENT PANEL =====
    void initViewPanel() {
        JPanel panel = new JPanel(new BorderLayout());
        JTextArea textArea = new JTextArea();
        textArea.setEditable(false);
        JScrollPane scroll = new JScrollPane(textArea);
        JButton refreshBtn = new JButton("Refresh");
        JButton backBtn = new JButton("Back");

        JPanel btnPanel = new JPanel();
        btnPanel.add(refreshBtn);
        btnPanel.add(backBtn);

        refreshBtn.addActionListener(e -> {
            StringBuilder sb = new StringBuilder();
            for(Student s : students) sb.append(s.getSummary()).append("\n");
            textArea.setText(sb.toString());
        });

        backBtn.addActionListener(e -> cardLayout.show(mainPanel, "menu"));

        panel.add(scroll, BorderLayout.CENTER);
        panel.add(btnPanel, BorderLayout.SOUTH);

        mainPanel.add(panel, "view");
    }

    public static void main(String[] args) {
        SwingUtilities.invokeLater(StudentSystemGUI::new);
    }
}
